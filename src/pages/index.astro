---
import "../styles/global.css";
import Mapa from "../components/Mapa.jsx";

// Validación de seguridad para API_URL
const apiUrl = import.meta.env.API_URL;

// Verificar que API_URL esté definida
if (!apiUrl) {
  throw new Error(
    '❌ ERROR DE CONFIGURACIÓN: La variable de entorno API_URL no está definida. ' +
    'Por favor, configura API_URL en tu archivo .env o en la configuración de Azure.'
  );
}

// Validar que sea una URL válida con protocolo HTTPS
try {
  const url = new URL(apiUrl);

  // En producción, solo permitir HTTPS
  if (import.meta.env.PROD && url.protocol !== 'https:') {
    throw new Error(
      '❌ ERROR DE SEGURIDAD: La API_URL debe usar protocolo HTTPS en producción. ' +
      `URL actual: ${apiUrl}`
    );
  }

  // Validar que tenga un host válido
  if (!url.host || url.host === '') {
    throw new Error(
      '❌ ERROR DE CONFIGURACIÓN: La API_URL no tiene un host válido. ' +
      `URL actual: ${apiUrl}`
    );
  }
} catch (error) {
  if (error instanceof TypeError) {
    throw new Error(
      `❌ ERROR DE CONFIGURACIÓN: La API_URL no es una URL válida. ` +
      `Valor actual: ${apiUrl}. Error: ${error.message}`
    );
  }
  throw error;
}
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aguas Transparentes</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  </head>
  <body class="bg-white m-0 p-0 h-screen w-screen overflow-hidden">
    <div class="w-full h-full">
      <Mapa client:only="react" apiUrl={apiUrl} />
    </div>
  </body>
</html>
